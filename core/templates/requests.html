{% extends 'base.html' %}
{% block title %}Мои заявки{% endblock %}

{% block content %}
<div class="requests-grid">

    <!-- Исходящие заявки -->
    <section class="request-section outgoing">
        <h2>Исходящие заявки</h2>
        {% for r in outgoing %}
        <div class="request-card">
            <img src="{{ r.product.image.url }}" alt="{{ r.product.title }}" class="request-img">
            <div class="request-info">
                <strong>{{ r.product.title }}</strong>
                <span>Продавец: @{{ r.owner.username }}</span>
                <span>Действие: {{ r.get_action_display }}</span>
                <span>Статус: {{ r.get_status_display }}</span>
                {% if r.status == 'pending' %}
                <div class="btn-group">
                    <form method="post" class="inline">{% csrf_token %}
                        <input type="hidden" name="req_id" value="{{ r.id }}">
                        <button name="decision" value="cancel" class="btn">Отменить</button>
                    </form>
                </div>
                {% elif r.status == 'accepted' %}
                <div class="btn-group">
                    <form method="post" class="inline">{% csrf_token %}
                        <input type="hidden" name="req_id" value="{{ r.id }}">
                        <button name="decision" value="complete" class="btn">Завершить</button>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <p>Нет исходящих заявок.</p>
        {% endfor %}
    </section>

    <!-- Входящие заявки -->
    <section class="request-section incoming">
        <h2>Входящие заявки</h2>
        {% for r in incoming %}
        <div class="request-card">
            <img src="{{ r.product.image.url }}" alt="{{ r.product.title }}" class="request-img">
            <div class="request-info">
                <strong>{{ r.product.title }}</strong>
                <span>Запросил: @{{ r.requester.username }}</span>
                <span>Действие: {{ r.get_action_display }}</span>
                <span>Статус: {{ r.get_status_display }}</span>
                {% if r.status == 'pending' %}
                <div class="btn-group">
                    <form method="post" class="inline">{% csrf_token %}
                        <input type="hidden" name="req_id" value="{{ r.id }}">
                        <button name="decision" value="accept" class="btn">Принять</button>
                        <button name="decision" value="reject" class="btn">Отклонить</button>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <p>Нет входящих заявок.</p>
        {% endfor %}
    </section>

</div>
{% endblock %}