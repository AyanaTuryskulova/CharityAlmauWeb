{% extends 'base.html' %}
{% load static %}

{% block title %}–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä{% endblock %}

{% block content %}
<div class="add-page"> <!-- –ù–û–í–ê–Ø –æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <h2 class="add-title">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä üì¶</h2>

    <form method="post" enctype="multipart/form-data" class="product-form">
        {% csrf_token %}
        {{ form.non_field_errors }}
        <div>
            <label for="id_name">–ò–º—è:</label>
            {{ form.name }}
        </div>

        <div>
            <label for="id_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
            {{ form.title }}
        </div>

        <div>
            <label for="id_description">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
            {{ form.description }}
        </div>

        <div>
            <label for="id_phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
            {{ form.phone }}
        </div>

        <div>
            <label for="id_type">–¢–∏–ø:</label>
            {{ form.type }}
        </div>

        <div>
            <label for="id_main_category">–û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            {{ form.main_category }}
        </div>

        <div>
            <label for="id_subcategory">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            {{ form.subcategory }}
        </div>

        <div>
            <label for="id_sub_subcategory">–ü–æ–¥–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            {{ form.sub_subcategory }}
        </div>

        <div>
            <label for="id_image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>
            {{ form.image }}
        </div>

        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>
</div>

<style>
    /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ñ–æ—Ä–º—É –ø–æ —Å–µ—Ä–µ–¥–∏–Ω–µ —ç–∫—Ä–∞–Ω–∞ */
    .add-page {
        min-height: calc(100vh - 120px);
        /* –∑–∞–ø–∞—Å –ø–æ–¥ –Ω–∞–≤–±–∞—Ä/–æ—Ç—Å—Ç—É–ø—ã */
        display: flex;
        flex-direction: column;
        align-items: center;
        /* –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
        justify-content: center;
        /* –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
        padding: 20px 12px;
    }

    .add-title {
        text-align: center;
        color: #024080;
        /* —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å–∏–Ω–∏–π */
        margin-bottom: 16px;
    }

    .product-form {
        max-width: 500px;
        width: 100%;
        margin: 0 auto;
        /* –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π */
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 20px;
        background: #f9f9f9;
        border-radius: 12px;
    }

    .product-form label {
        font-weight: bold;
    }

    .product-form select,
    .product-form input,
    .product-form textarea {
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ccc;
        width: 100%;
    }

    /* –ö–Ω–æ–ø–∫–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
    .product-form button {
        background-color: #024080;
        color: white;
        padding: 10px 18px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        align-self: center;
        /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –≤–Ω—É—Ç—Ä–∏ —Ñ–æ—Ä–º—ã */
    }

    .back-button {
        display: inline-block;
        margin-bottom: 10px;
        padding: 6px 12px;
        background-color: #eee;
        color: #333;
        text-decoration: none;
        border-radius: 6px;
        transition: background 0.2s;
    }

    .back-button:hover {
        background-color: #ddd;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const mainCategory = document.getElementById('id_main_category');
        const subcategory = document.getElementById('id_subcategory');
        const subSubcategory = document.getElementById('id_sub_subcategory');

        function loadCategories(parentId, targetSelect, placeholder) {
            fetch(`/get-subcategories/${parentId}/`)
                .then(response => response.json())
                .then(data => {
                    targetSelect.innerHTML = `<option value="">${placeholder}</option>`;
                    data.forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat.id;
                        option.textContent = cat.name;
                        targetSelect.appendChild(option);
                    });
                    targetSelect.disabled = false;
                });
        }

        if (mainCategory) {
            mainCategory.addEventListener('change', function () {
                const id = this.value;
                if (id) {
                    loadCategories(id, subcategory, '-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é --');
                    subSubcategory.innerHTML = '<option value="">-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é --</option>';
                    subSubcategory.disabled = true;
                }
            });
        }

        if (subcategory) {
            subcategory.addEventListener('change', function () {
                const id = this.value;
                if (id) {
                    loadCategories(id, subSubcategory, '-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥-–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é --');
                }
            });
        }
    });
</script>
{% endblock %}